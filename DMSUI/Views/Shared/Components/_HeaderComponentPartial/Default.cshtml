

@{
    var token = Context.Request.Cookies["access_token"];

    string email = "";
    string role = "";
    string userId = "";
    string positionName = "";
    string userName = "";

    if (!string.IsNullOrEmpty(token))
    {
        var handler = new JwtSecurityTokenHandler();

        try
        {
            var jwt = handler.ReadJwtToken(token);

            email = jwt.Claims.FirstOrDefault(x => x.Type == JwtRegisteredClaimNames.Email)?.Value ?? "";
            role = jwt.Claims.FirstOrDefault(x => x.Type == "role")?.Value ?? "";
            userId = jwt.Claims.FirstOrDefault(x => x.Type == JwtRegisteredClaimNames.Sub)?.Value ?? "";
            positionName = jwt.Claims.FirstOrDefault(x => x.Type == "positionName")?.Value ?? "";
            userName = jwt.Claims.FirstOrDefault(x => x.Type == "userName")?.Value ?? "";
        }
        catch
        {
            Context.Response.Cookies.Delete("access_token");
            Context.Response.Cookies.Delete("refresh_token");
        }
    }
}
@if (!string.IsNullOrEmpty(email))
{
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm">
        <div class="container-fluid">

            <a id="navbarDmsToggle"
               class="navbar-brand fw-bold text-primary"
               href="javascript:void(0);">
                DMS
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">

                    <li class="nav-item">
                        <a class="nav-link fw-semibold text-dark" asp-controller="Dashboard" asp-action="Index">
                            Dashboard
                        </a>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle fw-semibold text-dark" href="#" role="button" data-bs-toggle="dropdown">
                            Dokümanlar
                        </a>
                        <ul class="dropdown-menu shadow-sm">
                            <li><a class="dropdown-item" asp-controller="Document" asp-action="Index">Tüm Dokümanlar</a></li>
                            <a class="dropdown-item"
                               asp-controller="Document"
                               asp-action="SelectCategory">
                                Yeni Doküman
                            </a>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" asp-controller="Category" asp-action="Index">Kategoriler</a></li>
                        </ul>
                    </li>

                    @if (role == "SUPER_ADMIN" || role == "Admin")
                    {
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle fw-semibold text-warning" href="#" role="button" data-bs-toggle="dropdown">
                                Sistem
                            </a>
                            <ul class="dropdown-menu shadow-sm">
                                <li><a class="dropdown-item" asp-controller="User" asp-action="Index">Kullanıcılar</a></li>
                                <li><a class="dropdown-item" asp-controller="Company" asp-action="Index">Şirketler</a></li>
                                <li><a class="dropdown-item" asp-controller="Role" asp-action="Index">Roller</a></li>
                                <li><a class="dropdown-item" asp-controller="Department" asp-action="Index">Departmanlar</a></li>
                                <li><a class="dropdown-item" asp-controller="Position" asp-action="Index">Pozisyonlar</a></li>
                                <li><a class="dropdown-item" asp-controller="Document" asp-action="RejectedDocuments">Reddedilen Dokümanlar</a></li>
                                <li><a class="dropdown-item" asp-controller="Audit" asp-action="Index">AccessLog</a></li>
                            </ul>
                        </li>
                    }
                </ul>

                <form asp-controller="Search"
                      asp-action="Index"
                      method="get"
                      class="d-flex mx-lg-4">

                    <input name="query"
                           class="form-control form-control-sm"
                           placeholder="Doküman, kategori ara..." />

                    <button class="btn btn-outline-primary btn-sm ms-2">
                        Ara
                    </button>
                </form>
                <ul class="navbar-nav ms-auto">

                    <li class="nav-item me-3 d-flex align-items-center text-dark">
                        <small class="text-end">
                            <div class="fw-semibold">@userName</div>
                            <div class="text-muted">@positionName</div>
                        </small>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-dark" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle fs-5"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow-sm">
                            <li>
                                <a class="dropdown-item"
                                   asp-controller="User"
                                   asp-action="Detail"
                                   asp-route-id="@userId">
                                    Profil
                                </a>
                            </li>
                            <li><a class="dropdown-item" asp-controller="User" asp-action="ChangePassword" >Şifre Değiştir</a></li>
                            @if (role == "SUPER_ADMIN" || role == "Admin" || role == "Approver")
                            {
                                <li><a class="dropdown-item" asp-controller="Approval" asp-action="Index" >Onay Bekleyen Dokümanlar</a></li>
                                <li><a class="dropdown-item" asp-controller="Document" asp-action="MyActiveRevisions">Açık Revizyonlarım</a></li>
                            }
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item text-danger"
                                   asp-controller="Auth"
                                   asp-action="Logout">
                                    Çıkış Yap
                                </a>
                            </li>
                        </ul>
                    </li>

                </ul>

            </div>
        </div>
    </nav>
}
